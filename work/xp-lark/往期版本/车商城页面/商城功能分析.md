# 1. 商品上下架与页面缓存
## 1.1. 装修页面
1. 获取装修页面（数据库中数据）  
    ```java
        // 获取生效装修页面
        StoreDecorateQueryDto getEffectiveDecorateByStoreId(String storeId, StoreDecorateScene storeDecorateScene, String pageId)
        // 获未草稿装修页面
        StoreDecorateQueryDto getDraftDecorateByStoreId(String storeId, StoreDecorateScene storeDecorateScene, String pageId);
    ```
2. C端访问装修页面（缓存）
   `com.xiaopeng.xplarktrade.core.service.impl.StoreDecorateServiceImpl#view` 方法为C端访问商城微页面入口。

   其返回体 `ViewVo` 中包含的信息有  
   - 页面名称
   - 页面类型（区分车商城、精品商城）
   - 模块列表（有顺序）

   ***模块中包含：模块类型，图片链接，跳转地址，优惠券，酒店，视频等信息***  

   该方法会尝试从缓存中获取数据，若缓存中没有该数据对应的key，则尝试从数据库中加载出事实数据，并将之写入缓存（没有设置过期时间）。

   以下为该方法代码

    ``` java
    public ViewVo view(String storeId, Integer scene, String pageId) {
            // 查找页面
            String key = redisService.joinKey(RedisConstant.LARK_PAGE_INFO, pageId);
            ViewVo viewVo;
            if (redisService.hasKey(key)) {
                viewVo = redisService.get(key, ViewVo.class);
            } else {
                viewVo = getNewestViewVo(storeId, scene, pageId);
                redisService.set(key, viewVo);
            }
            return viewVo;
        }
    ```

## 1.2. 商品信息
1. 商品缓存主动刷新
   
