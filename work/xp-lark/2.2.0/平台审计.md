# 1. 平台审计  

- [1. 平台审计](#1-平台审计)
  - [1.1. 配置内容](#11-配置内容)
  - [1.2. SQL相关](#12-sql相关)

## 1.1. 配置内容  

```properties  
# 数据库
spring.datasource.username = xp_lark_admin
spring.datasource.url = jdbc:mysql://rm-bp1s5j61e7y6h5036.mysql.rds.aliyuncs.com/xp_lark_admin?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=GMT%2B8

# 平台审计开关
lark.audit.open = true
# 平台审计不需要审计的POST uri列表
xiaopeng.audit.notNeedAuditList = /v1/api/auditLog/pageList,/v1/api/baseData/pageStaticData
# 平台审计需要审计的GET uri列表
xiaopeng.audit.needAuditList = /v1/api/commonCouponLog/export,v1/api/commonCoupon/export,/v1/api/cancelOrder/export,/v1/api/couponCard/export,/v1/api/CouponPackage/export,/v1/api/marketCoupon/export,/v1/api/commonCoupon/export,/v1/api/goods/exportSku,/v1/api/order/export/for/item,/v1/api/order/export/for/order,/v1/api/refund/export
```

## 1.2. SQL相关  

```sql
-- 审计日志表
CREATE TABLE `audit_log` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '自增主键',
  `log_id` varchar(64) NOT NULL COMMENT '业务主键',
  `operator_uid` bigint(20) NOT NULL DEFAULT '0' COMMENT '操作人uid',
  `operator_name` varchar(32) NOT NULL DEFAULT '' COMMENT '用户名',
  `request_uri` varchar(128) NOT NULL DEFAULT '' COMMENT '请求uri',
  `request_time` datetime NOT NULL COMMENT '请求时间',
  `uri_name` varchar(100) NOT NULL DEFAULT '' COMMENT '路径名称',
  `request_payload` text NOT NULL COMMENT '请求体',
  `response_code` int(4) NOT NULL DEFAULT '200' COMMENT '响应码',
  `client_ip` varchar(255) DEFAULT NULL COMMENT '客户端IP',
  `user_agent` varchar(512) NOT NULL DEFAULT '' COMMENT 'UA',
  `create_time` datetime NOT NULL COMMENT '创建时间',
  `update_time` datetime NOT NULL COMMENT '更新时间',
  `is_delete` tinyint(2) NOT NULL DEFAULT '2' COMMENT '是否删除| 1-是 2-否',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_log_id` (`log_id`),
  KEY `idx_reqTime_uid_uri` (`request_time`,`operator_uid`,`request_uri`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='审计日志表';
```
