# 设计要点
## 收款主体调整  
1. 收款主体支持“小鹏服务公司”主体进行收款，需要配合`支付中心`，`ERP`, `VATP`联调实现新主体。  
2. 将收款主体字段移交到前端控制
## 酒店售后规则  
1. 淡旺季动态售后配置  
   - 旺季订单 | 定义：入离时间与旺季时间有交集；规则：默认统一不支持退订
   - 非旺季订单| 定义：入离时间与旺季时间没有交集；规则：离入住前n天（1-7）天可退，仅支持整单退款

## 结算规则
1. ERP按订单入住日期T+1日进行结算
   1. 方案一：对C端客户的售后及对酒店的结算分离，不再捆绑在一起

--- 
# 疑问点
## 收款主体
## 酒店淡旺季
1. 淡旺季配置的对象是针对spu层级还是sku层级？
2. 酒店的淡旺季是否只区分淡季和旺季？一年中淡季的时间多还是旺季的时间多？
3. 若在客户下单时，预定的日期的尚未配置（默认淡季），在下单后运营对这段时间进行了配置，该订单如何处理？是否需要考虑该场景。备注：酒店预定目前最远只能预定到30天
4. 淡季可退时间字段存储位置（预定spu_hotel）
## 结算规则

---  
# 功能改动点
## 收款主体
## 酒店淡旺季相关
1. 新增内容
   1. 新增淡旺季配置时间表
   2. C端需要获取淡旺季信息用于展示（后端需提供一个查询接口用于获取数据）
   3. `spu_hotel`增加`refundable_time` 用于标识酒店淡季订单，入住前多少天可退。
   4. 现有`order_hotel_info`表中增加一个`last_after_sale_time`（最后可售后时间）字段，用于标记订单最后可退时间。
2. 内容修改
   1. 酒店类商品售后规则流程更改针对酒店类商品，商品的售后流程需要做特殊处理。
## 结算规则
1. 方案一：离店日期之后一天抛账给ERP，抛帐信息中去除`结算日期`，仅保留`入住日期`、`留店日期`。

---  
# 概要设计
## 收款主体
1. 增加一个新的收款主体--小鹏服务
## 混合支付
无需代码改动
## 酒店动态售后
### 淡旺季配置数据结构
1. 订单类型区分  
   - order_hotel_info中增加一个

#### 淡旺季信息表结构其一
1. hotel_off_peak_info 表结构：
   |id|spu_id|begin_time|end_time|  
   |--|--|--|--|  
   |自增主键|对应酒店的spu_id|时间段开始时间|结束时间|  
   |bigint|varchar(64)|datetime|datetime|  
   |索引项|索引项|||
   
   上述结构中，一个酒店（spu_id）有多个配置项，用以表示多个旺季时间段。  
2. 算法概述
   - 修改或者新增操作判断：所选时间段是否与已有数据产生交集|有：更新，无：新增
   - 更新操作：
#### 淡旺季表结构其二
1. hotel_off_peak_info 表结构：
   |id|spu_id|start_and_end_time_list|
   |--|--|--|
   |自增主键|对应酒店的spu_id|旺季时间对列表|
   |bigint|varchar(64)|json|
   在上述表中：json对应的对象结构为
   ```java
   class Obj {
      List<StartAndEndTime> offPeakInfoList;
      @Data
      @Accessors(chain = true)
      public static class StartAndEndTime{
         private Date start;
         private Date end;
      }
   }
   ```

### 结算规则
- 给erp抛帐中只提供入住日期以及离店日期
