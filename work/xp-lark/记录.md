# 记录

<!-- TODO: java.io.Serializable -->
<!-- TODO: @java.io.Serial -->

<!-- TODO: java super -->
<!-- TODO: java this -->
<!-- TODO: java 中的异常 -->
<!-- TODO: org.aspectj.lang.annotation.Aspect -->
<!-- TODO: spring cloud -->
<!-- TODO: k8s -->
<!-- TODO: bootstrap -->
<!-- TODO: 《领域驱动设计：软件核心复杂性应对之道》 -->
<!-- TODO： 链式查询 -->

本机调试可以使用schedued，姿势如下：

```java
// application中增加
@Configuration
@EnableScheduling
// service中方法上增加
@Scheduled(cron = "0/5 * * * * ?")
```

## 常见事项

1. 入参dto中增加判断注解
2. hotelsnapshotservice中去掉无效的判断
3. 出参dto中去掉无效的字段
4. 接口调用和使用放在一起来（查询和赋值放在一块）

## 常见知识

### 幻读

1. 描述：一个事务(同一个read view)在前后两次查询同一范围的时候，后一次查询看到了前一次查询没有看到的行。
   1. 在可重复读隔离级别下，普通查询是快照读，是不会看到别的事务插入的数据的，幻读只在当前读下才会出现。
   2. 幻读专指新插入的行，读到原本存在行的更新结果不算。因为当前读的作用就是能读到所有已经提交记录的最新值。

2. 产生原因
   - 行锁只能锁住行，即使把所有的行记录都上锁，也阻止不了新插入的记录。

3. **解决方法**
   - 将两行记录间的空隙加上锁，阻止新记录的插入；这个锁称为间隙锁。
   - 间隙锁与间隙锁之间没有冲突关系。跟间隙锁存在冲突关系的，是往这个间隙中插入一个记录这个操作。
