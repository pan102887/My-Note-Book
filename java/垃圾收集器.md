# JVM中的经典垃圾收集器

## 新生代的收集器

### Serial 收集器

- **特点**: 单线程，穿行，标记-复制法
- **可搭配的老年代收集器**: Serial Old，CMS（JDK 9及以后版本不再支持）
- **适用场景**: 适用于对内存占用要求不高的场景

新生代收集器，单线程，串行，STOP-THE-WORLD，标记-复制法，可搭配的老年代收集器有：Serial Old， CMS（JDK 9及以后版本不再支持）。

## ParNew 收集器

- **特点**：多线程，标记-复制法，Serial的多线程版，GC时STOP-THE-WORLD后再标记-复制。
- **可搭配的老年代收集器**：CMS, Serial Old
- **适用场景**：适用于多处理器环境下，提升垃圾回收效率

### ParNew 收集器的工作原理

在标记阶段，ParNew收集器会暂停所有应用线程（Stop-The-World），然后使用多个线程并行地扫描新生代中的对象，标记出存活的对象。在复制阶段，ParNew收集器会将存活的对象从Eden区和一个Survivor区复制到另一个Survivor区，同时清理掉Eden区和之前使用的Survivor区。（整个GC阶段都会STW）

## Parallel Scavenge 收集器

- **特点**：多线程，标记-复制法，注重吞吐量
- **可搭配的老年代收集器**：Parallel Old, Serial Old

新生代收集器，多线程，并行，标记-复制法。可搭配的老年代收集器有：Serial Old, Parallel Old。
  
### Parallel Scavenge 收集器的工作原理 & 与Parnew的区别

相同点&原理：Parallel Scavenge收集器的工作原理与ParNew类似，都是在GC时暂停所有应用线程（Stop-The-World），然后使用多个线程并行地扫描新生代中的对象，标记出存活的对象，并将存活的对象从Eden区和一个Survivor区复制到另一个Survivor区，同时清理掉Eden区和之前使用的Survivor区。

差异：Parallel Scavenge收集器更注重吞吐量（Throughput），即应用程序运行时间与垃圾回收时间的比例。它提供了一些调优参数，如-XX:MaxGCPauseMillis和-XX:GCTimeRatio，允许开发者根据应用需求调整GC行为。而ParNew收集器则更注重响应时间，适用于对延迟敏感的应用场景。

总结：ParNew收集器的GC频次比较高，适用于对响应时间要求较高的应用；而Parallel Scavenge收集器则GC频次更低，更适合对吞吐量有较高要求的应用。

## Serial Old 收集器

老年代收集器，单线程，串行，STOP-THE-WORLD，标记-清除法。可搭配的新生代收集器有：Serial, ParNew(JDK 9及以后版本不再支持)，Parallel Scavenge。

## Parallel Old 收集器

老年代收集器，多线程，并法，标记-整理法。可搭配的新生代收集器有：Parallel Scavenge

## CMS 收集器

老年代收集器，多线程，并法（初始标记与重新标记阶段仍需要STW），标记-清除法。

- 初始标记
- 并发标记
- 重新标记
- 并发清除

由于CMS工作过程中会与用户线程并发执行，因此在收集过程中需要留出一定内存空间给用户线程使用。所以CMS不能像其他收集器那样等待老年代几乎被填满了再进行收集。JDK 5的默认设置中，老年代使用率达到68%后就会触发收集，JDK 6中则默认调整到92%。可以通过-XX：CMSInitiatingOccupancyFraction的值来调整CMS触发阈值，调高可以降低GC触发频率，但要注意不能调太高，太高容易导致“并发失败”，从而引起JVM冻结用户线程，转而使用Serial Old收集器重新收集老年代，这样会导致GC引起的停顿时间变长。

为了解决碎片化的问题，CMS提供了一个-XX:+UseCMSCompactAtFullCollection(默认开启，JDK9中废弃)，指定CMS在Full Collection时，进行内存碎片整理。但是整理时会冻结用户线程。

## G1 (Garbage first)收集器

全堆收集器，基于Region(区域)，多线程，并发，标记清除法。

G1收集器也是基于分代理论设计的，但和之前不同的地方在于：其堆内存不再以固定大小及固定数量进行分代区域划分，而是把连续的java堆划分为多个大小相等的独立区域，每个区域可以根据需要，扮演新生代Eden空间、Survivor空间，或者老年代Old空间。新生代和老年代不再是一块固定的连续的一块空间了，而是一系列区域（不要求连续）的动态组合。

G1收集器在并发标记阶段，通过原始快照算法(SATB)实现.

## ZGC 收集器
