# kafka 常见问题

## Kafka为何快

### 磁盘I/O顺序读写优化

Kafka利用了操作系统对顺序读写的高度优化，消息会以追加写入的形式写入文件的末尾，避免了磁盘的寻道时间。大幅提升了I/O吞吐量。

### 零拷贝

Kafka通过sendFile系统调用，将数据从磁盘直接传入到网络缓冲区，跳过了在用户空间与内核空间之间复制数据的过程，减少了CPU的开销和延迟

### 合并消息与压缩进行批量处理优化

- 生产者将多个小消息聚合为一个大的批次发送，减少了网络请求次数。
- 并在批量处理基础上进行数据压缩，使用（GZIP, Snappy, LZ4等），在不显著增加CPU成本的情况下，减少了传输的数据量，大幅降低了网络IO的压力。

### 利用不同分区并行处理

利用
 
## Kafka架构

## Kafka主从同步

## Kafka什么时候会丢失数据

### 生产者阶段

#### 异步发送模式

生产者发送数据时，消息首先进入内存缓冲区，由专门的线程异步发送。如果生产者应用程序在消息发送到Broker前崩溃，缓冲区中的消息可能会丢失。

#### acks配置不当

- acks=0，即生产者没有等待任何确认，发送后即认为成功。可能会因网络抖动等原因导致数据丢失。
- acks=1, 生产者只等待Partition的Leader节点写入成功的确认，如果Leader节点的数据在同步到副本（Follower）之前宕机，这些未同步的数据可能会丢失。

### Broker中

由于Kafka为了得到更高的性能与吞吐量，将数据异步地批量地存储到磁盘（Page cache）。数据通过文件系统写入时，会先写入到Page cache，再由时间或者其他条件触发刷盘动作。如果数据还在Page Cache中时，系统挂了就会导致数据丢失。（并且kafka也没有提供一个同步刷盘的方式）



